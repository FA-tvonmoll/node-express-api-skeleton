#!/usr/bin/env node

// This file contains application startup code. Originally generated by the Express Application
// Generator (https://expressjs.com/en/starter/generator.html), and then modularized into functions
// for greater clarity.

'use strict';

/* eslint-disable global-require */

function initialize() {
  function getLogFunctionFactory(config) {
    const debug = require('debug');
    debug.enable(config.debug);

    return require('../src/services/logFunctionFactory');
  }

  function monitorAndLog(server, port, config) {
    const logFunctionFactory = getLogFunctionFactory(config);
    const onError = require('./onError');
    server.on('error', onError);

    const logStart = require('./logStart');
    logStart(port, config.nodeEnv, logFunctionFactory);
  }

  const config = require('../src/config');
  const app = require('../src/app');
  const port = parseInt(config.desiredPort, 10);
  const server = app.listen(port);

  monitorAndLog(server, port, config);
}

initialize();
